# 🦠 Malware Analysis
A curated list of awesome malware analysis tools and resources.

## Types of Malware Attacks 🕵️‍♂️

| Type                | What It Does                                            | Real-World Example  |
|---------------------|---------------------------------------------------------|----------------------|
| 💥 Ransomware        | Disables victim's access to data until ransom is paid  | RYUK                 |
| 🕵️‍♂️ Fileless Malware | Makes changes to files that are native to the OS       | Astaroth             |
| 🧑‍💻 Spyware          | Collects user activity data without their knowledge     | DarkHotel            |
| 📢 Adware             | Serves unwanted advertisements                          | Fireball             |
| 🐍 Trojans            | Disguises itself as desirable code                      | Emotet               |
| 🪱 Worms              | Spreads through a network by replicating itself         | Stuxnet              |
| 👾 Rootkits           | Gives hackers remote control of a victim's device       | Zacinlo              |
| ⌨️ Keyloggers         | Monitors users' keystrokes                              | Olympic Vision       |
| 🤖 Bots               | Launches a broad flood of attacks                       | Echobot              |
| 📱 Mobile Malware     | Infects mobile devices                                  | Triada               |

## Malware Analysis Process 🔍

### 🔒 Static Analysis
Static Analysis can be done by examining the physical states of a file. For example, Windows uses the **Portable Executable (PE) Format** to describe executable (image) files, and we can analyze PE files to detect malware.

### 🔄 Dynamic Analysis
Dynamic Analysis is done by observing the behavior of the malware in a sandbox environment. This includes monitoring:
- **Registry Operations**
- **File Operations**
- **API Calls**
- **DLL Loading**
- **Mutex Information** 

### 🧑‍💻 Code Analysis
Reversing code using **debuggers** to understand the inner workings of the malicious software. Tools like **Disassemblers** and **Decompilers** help break down the code.

### 🧠 Memory Analysis
Dumping the entire system memory and analyzing processes and handlers. This is crucial for detecting:
- **Rootkits**
- **Ransomware Encryption Keys**
- **Hidden Processes**

## Tools 🧰

### Static Analysis 🧐
- **pestudio** - Static analysis of Windows executables. [pestudio](https://www.hatchingsoft.com/pestudio)
- **CFF Explorer** - Suite of tools for checking the import/export directories and PE headers. [CFF Explorer](https://ntcore.com/?page_id=388)

### Dynamic Analysis 🛠️
- **Process Hacker** - Monitors system resources. [Process Hacker](https://processhacker.sourceforge.io/)
- **Process Monitor** - Advanced tool for monitoring Windows programs. [ProcMon](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon)
- **RegShot** - Registry compare utility. [RegShot](https://github.com/uce/Regshot)
- **ProcDot** - Graphical malware analysis toolkit. [ProcDot](https://github.com/sans-dfir/ProcDot)

### Code Analysis 👨‍💻
- **Disassembler**: **IDA** (Interactive Disassembler) [IDA Pro](https://www.hex-rays.com/products/ida/)
- **Decompiler**: **IDA Pro** [IDA Pro](https://www.hex-rays.com/products/ida/)
- **Debuggers**: 
  - **X64dbg** - Open-source debugger for Windows [X64dbg](https://x64dbg.com/)
  - **WinDbg** - Multipurpose debugger for Windows [WinDbg](https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/)

### Memory Forensics 🔍
- **Memory Acquisition**: **Comae-Toolkit** (Use DumpIt.exe for full memory dumps). [Comae-Toolkit](https://comae.io/)
- **Memory Analysis**: **Volatility** - Advanced memory forensics framework. [Volatility](https://www.volatilityfoundation.org/)

### Online Scanners and Sandboxes 🌐
- **Cuckoo Sandbox** - Self-hosted, automated malware analysis system. [Cuckoo Sandbox](https://cuckoosandbox.org/)
- **VirusTotal** - Free online malware analysis tool. [VirusTotal](https://www.virustotal.com/)
- **Noriben** - Uses Sysinternals **Procmon** for sandboxed malware collection. [Noriben](https://github.com/google/noriben)
- **Intezer Analyzer** - MITRE ATT&CK Detection table. [Intezer Analyzer](https://www.intezer.com/)

### Network 🌍
- **Wireshark** - A popular tool for analyzing network traffic. [Wireshark](https://www.wireshark.org/)

### Android 📱
- **MobSF** - Automated mobile application security framework. [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

### Service Emulation 🌐
- **INetSim** - Simulates network services for building a malware lab. [INetSim](https://github.com/CoboltSec/INetSim)
- **FakeNet** - Windows network simulation tool for malware analysis. [FakeNet](https://github.com/axgx/FakeNet-NG)

## Useful Languages to Learn 📚
- **Python** 🐍 - For automating analysis tasks.
- **C++** 💻 - Often used in the development of malware.
- **Assembly** 🔧 - Critical for reversing low-level code.

## Useful Tools 🛠️
- **yara** - Tool for creating and running malware detection rules. [YARA](https://github.com/VirusTotal/yara)
- **Python 3.8.0** - Required for ret-sync and IDA modules.
- **yara-python** - Needed for the IDA module. [Yara Python](https://github.com/VirusTotal/yara-python)
- **ret-sync** - Synchronizes debugging sessions with IDA/Ghidra/Binary Ninja. [ret-sync](https://github.com/synacktiv/ret-sync)

## Malicious Windows APIs 🖥️
- **Downloader**: `urldownloadtofile`, `shellexec`
- **Dropper**: `findresource`, `loadresource`, `lockresource`, `sizeofresource`
- **Keylogger**: `getkeystate`, `getasynckeystate`, `setwindowshook`
- **C2 Server**: `internetopenurla`, `socket`

## Tips 🔑
- Every `.exe` file can have **import DLLs** or API calls.
- **New malware** might not use import DLLs, making it harder to detect.
- Use **IDA** -> `View` -> `Subview` -> `String` to see strings in PE files.
- **Ransomware** typically uses symmetric encryption (e.g., SHA256) to encrypt data and asymmetric encryption (e.g., RSA) for encryption keys sent to C2 servers.
- Some malware may have **digital signatures**, and attackers may steal the signing keys.
- **Packers** are used to obfuscate malware.
- **Fuzzy Hashing** tools like **ssdeep** can detect similarities between malware variants.
- **WinExec** is an export function from `kernel32.dll` and can be used maliciously.
- **IDA Pro** can be used to create basic blocks for application analysis.
- **Procmon** export to CSV and use **ProcDot** for generating graphical PNGs of malware behavior.
- Most **ransomware** are 32-bit, which makes them capable of running on both 32-bit and 64-bit systems.
- Complex networks are key for **ransomware** success; use **FakeNet** tools for simulating network services.
- **PatchGuard** in Windows 8 and higher can detect certain rootkits and stop them from functioning.

## Books 📚
- **Practical Malware Analysis**
- **Practical Reverse Engineering: x86, x64, ARM, Windows Kernel, Reversing Tools, and Obfuscation**

## References 🔗
- [A COMPLETE PRACTICAL APPROACH TO MALWARE ANALYSIS AND MEMORY FORENSICS - 2021 EDITION](https://www.amazon.com/)
- [Awesome Malware Analysis](https://github.com/malware-analysis-and-reverse-engineering)

